{
  "workflow_name": "ç¦ååˆ›æ–°AIé£æ§æŒ‡æŒ¥ç³»ç»Ÿ",
  "description": "æ™ºèƒ½æ— äººæœºè°ƒåº¦å·¥ä½œæµ",
  "nodes": [
    {
      "id": "trigger",
      "type": "trigger",
      "name": "ç”¨æˆ·è¾“å…¥è§¦å‘",
      "config": {
        "trigger_type": "user_message",
        "extract_variables": [
          {
            "name": "target_lat",
            "description": "ç›®æ ‡çº¬åº¦",
            "type": "number",
            "required": true
          },
          {
            "name": "target_lng", 
            "description": "ç›®æ ‡ç»åº¦",
            "type": "number",
            "required": true
          },
          {
            "name": "task_type",
            "description": "ä»»åŠ¡ç±»å‹",
            "type": "string",
            "default": "patrol",
            "options": ["patrol", "surveillance", "emergency", "inspection"]
          }
        ]
      }
    },
    {
      "id": "format_data",
      "type": "code",
      "name": "æ•°æ®æ ¼å¼åŒ–",
      "config": {
        "language": "javascript",
        "code": "// ç”Ÿæˆä»»åŠ¡ID\nconst mission_id = 'coze_' + Date.now();\n\n// æ ¼å¼åŒ–è¯·æ±‚æ•°æ®\nconst request_data = {\n  flight_data: {\n    lat: target_lat.toString(),\n    lng: target_lng.toString(),\n    mission_id: mission_id,\n    task_type: task_type || 'patrol'\n  }\n};\n\nreturn {\n  request_data: request_data,\n  mission_id: mission_id\n};"
      },
      "inputs": ["target_lat", "target_lng", "task_type"],
      "outputs": ["request_data", "mission_id"]
    },
    {
      "id": "call_api",
      "type": "http_request",
      "name": "è°ƒç”¨é£æ§API",
      "config": {
        "method": "POST",
        "url": "http://localhost:8000/drone/command",
        "headers": {
          "Content-Type": "application/json"
        },
        "body": "{{request_data}}",
        "timeout": 10000
      },
      "inputs": ["request_data"],
      "outputs": ["api_response"]
    },
    {
      "id": "process_response",
      "type": "code", 
      "name": "å¤„ç†å“åº”ç»“æœ",
      "config": {
        "language": "javascript",
        "code": "// è§£æAPIå“åº”\nconst response = JSON.parse(api_response);\n\nif (response.status === 'success') {\n  const result_message = `âœ… é£è¡Œä»»åŠ¡è°ƒåº¦æˆåŠŸï¼\\n\\nğŸ“ ä»»åŠ¡ID: ${response.mission_id}\\nğŸ›« èµ·é£æœºåœº: ${response.selected_airport}\\nğŸ¯ ç›®æ ‡åæ ‡: (${response.target_coordinates.lat}, ${response.target_coordinates.lng})\\nğŸ›©ï¸ é£è¡Œåºåˆ—: ${response.flight_sequence.join(' â†’ ')}\\nâ° åˆ›å»ºæ—¶é—´: ${response.timestamp}`;\n  \n  return {\n    success: true,\n    message: result_message,\n    selected_airport: response.selected_airport,\n    mission_id: response.mission_id\n  };\n} else {\n  return {\n    success: false,\n    message: `âŒ ä»»åŠ¡è°ƒåº¦å¤±è´¥: ${response.message}`,\n    error: response.message\n  };\n}"
      },
      "inputs": ["api_response"],
      "outputs": ["success", "message", "selected_airport", "mission_id"]
    },
    {
      "id": "reply",
      "type": "reply",
      "name": "å›å¤ç”¨æˆ·",
      "config": {
        "message": "{{message}}"
      },
      "inputs": ["message"]
    }
  ],
  "connections": [
    {
      "from": "trigger",
      "to": "format_data"
    },
    {
      "from": "format_data", 
      "to": "call_api"
    },
    {
      "from": "call_api",
      "to": "process_response"
    },
    {
      "from": "process_response",
      "to": "reply"
    }
  ]
}